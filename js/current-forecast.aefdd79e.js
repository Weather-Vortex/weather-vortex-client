(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["current-forecast"],{"869d":function(t,e,i){"use strict";i.r(e);var n=function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("v-container",[i("v-row",[i("v-col",[i("ForecastGroup",{attrs:{fetching:t.fetching,initialForecasts:t.forecasts,initialMid:t.mid}})],1)],1)],1)},o=[],c=i("53ca"),s=(i("4ec9"),i("d3b7"),i("3ca3"),i("ddb0"),i("e9c4"),i("ac1f"),i("1276"),i("a9e3"),i("159b"),i("4de4"),i("b64b"),i("b680"),i("c35a"),i("0d03")),a=i("a229"),r=i("ec26"),u={name:"CurrentForecast",components:{ForecastGroup:a["a"]},computed:{connected:function(){return"undefined"!==typeof this.socket&&null!==this.socket&&this.socket.connected},loading:function(){return this.fetching>0}},data:function(){return{fetching:0,forecasts:[],initialMidData:{temp:0,tempMin:0,tempMax:0,pressure:0,humidity:0,clouds:0,rain:0,snow:0},midData:{},descriptions:new Map,icons:new Map,mid:{provider:"Aggregated",data:{}},socket:null,status:null,waiting:[]}},methods:{clean:function(){this.forecasts=[],this.waiting=[],this.mid.data=JSON.parse(JSON.stringify(this.initialMidData)),this.midData=JSON.parse(JSON.stringify(this.initialMidData)),this.descriptions=new Map,this.icons=new Map},connect:function(){var t=Object(r["a"])();this.socket=Object(s["a"])(),this.subscribe(),this.socket.auth={username:t},this.socket.connect({forceNew:!0})},disconnect:function(){var t=this.socket;t.off("connection"),t.off("connect_error"),t.off("forecast_requested"),t.off("result"),t.disconnect(),this.socket=null},requireForecasts:function(t){this.fetching=this.fetching+1,this.clean();var e=t.split(",");if(e&&2===e.length){var i=new Number(e[0]),n=new Number(e[1]);if(!isNaN(i)&&!isNaN(n))return console.log("Requiring %d::%d",i,n),void this.socket.emit("current",{latitude:i,longitude:n})}this.socket.emit("current",{locality:t})},subscribe:function(){var t=this;this.socket.on("connect",(function(){console.log("Socket Connected");var e=t.$route.params.locality;t.requireForecasts(e)})),this.socket.on("forecast_requested",(function(e){if(console.log("Args:",e),"object"!==Object(c["a"])(e.providers))return console.error("Received a corrupted packet from socket"),void(t.fetching=t.fetching-1);e.providers.forEach((function(e){t.waiting.push({provider:e})})),t.fetching=t.fetching+e.providers.length-1})),this.socket.on("connect_error",(function(e){console.warn("Connection error:",e),"Invalid locality"===e.message&&(t.selectedLocality=!1)})),this.socket.on("result",(function(e){var i=e.provider,n=e.data;console.log("Result from %s with %o:",i,n),t.fetching=t.fetching-1;var o=t.waiting.filter((function(t){return t.provider!==i}));t.waiting=o,t.forecasts.push({provider:i,data:n}),t.updateMid(n)}))},updateMid:function(t){var e=this,i=Object.keys(t);i.forEach((function(i){var n=Number(t[i]);if(isNaN(n)){var o=t[i];if("weatherDescription"===i){e.populateMap(o,e.descriptions);var c=e.getMostValueKeyFromMap(e.descriptions);e.mid.data.weatherDescription=c}else if("weatherIcon"===i){e.populateMap(o,e.icons);var s=e.getMostValueKeyFromMap(e.icons);e.mid.data.weatherIcon=s}}else{e.midData[i]+=n;var a=e.midData[i]/e.forecasts.length,r=Number.parseFloat(a).toFixed(2);e.mid.data[i]=r}}))},populateMap:function(t,e){if(e.has(t)){var i=e.get(t),n=i+1;e.set(t,n)}else e.set(t,1)},getMostValueKeyFromMap:function(t){var e=null,i=0;return t.forEach((function(t,n){i<t&&(e=n,i=t)})),e}},mounted:function(){this.connected||this.connect()},beforeRouteLeave:function(t,e,i){console.log("Before route leave from %s to %s",e,t),this.connected&&this.disconnect(),i()},destroyed:function(){this.connected&&this.disconnect()}},d=u,f=i("2877"),l=i("6544"),h=i.n(l),p=i("62ad"),g=i("a523"),m=i("0fd9"),v=Object(f["a"])(d,n,o,!1,null,null,null);e["default"]=v.exports;h()(v,{VCol:p["a"],VContainer:g["a"],VRow:m["a"]})}}]);
//# sourceMappingURL=current-forecast.aefdd79e.js.map